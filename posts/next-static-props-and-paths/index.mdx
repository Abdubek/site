---
title: Next.js Static Props
date: 2020-04-07
responsive: false
---

import {
  Hike,
  View,
} from "../../src/components/mdx-hiker"
import views from "./views"

<Hike views={views}>

<View />

A few weeks ago, [Zeit released Next.js 9.3](https://nextjs.org/blog/next-9-3). This new version introduces `getStaticProps` and `getStaticPaths`, two of the framework's coolest APIs. Why do I think these APIs are so cool? Let me show you with code.

Suppose you want to build a web site that displays Coronavirus stats. The home page shows information for each country with links to more details. All data comes from a [JSON file](https://github.com/pomber/covid19/) you can download from a public URL. The file is updated once per day.

Try to think about how would you build that site and then keep reading to see my approach using Next.js 9.3.

<View />

To start, in an empty folder, create a `package.json` file and add the dependencies: React, Next.js and a few more we'll need later.

> I'm assuming you have some experience with React. I'll introduce the features we are using from Next.js one by one, but it would be better if you already know what the framework does.

Also, add the scripts section.

<View />

### Pages

Next.js projects need a `pages/` folder. There you put JavaScript files that Next.js will turn into pages for your site. You only need to choose a filename and export a React component. The filename becomes the route to that page.

To try this, create `pages/index.js` file. In that file, export a React component. For now something that renders `<h1>Hello</h1>` will be enough.

Next.js will pre-render `pages/index.js` into `index.html`.

<View />

Before continuing, run the site and make sure everything is working.

Install the dependencies with `yarn install`.

And run Next.js in development mode with `yarn dev`.

<View />

The site should be live at http://localhost:3000. Open it on a new browser tab.

Now that you have the site running, add the features one by one. Start by downloading the JSON file with the Coronavirus data when the site loads.

<View />

### Client-side data fetching

Fetch `timeseries.json` from `https://pomber.github.io/covid19/`.

Wrap the fetch code inside a `useData` hook that returns `undefined` until the JSON file is downloaded.

In the `HomePage` component, call the `useData` hook and show "Loading..." until the data is ready.

Now, use the data for something.

<View />

The JSON file has the following content:

```json
{
  "China": [
    {
      "date": "2020-1-22",
      "confirmed": 548,
      "deaths": 17,
      "recovered": 28
    },
    {
      "date": "2020-1-23",
      "confirmed": 643,
      "deaths": 18,
      "recovered": 30
    },
    ...
  ],
  "Spain": [...],
  ...
}
```

Extract the last date from any of the time-series and show it.

---

Stop for a moment here. What have we done so far?

Everytime a user visit the site, it shows a loading screen until it downloads a big JSON, which is then transformed to less than 10 bytes of information.

<View />

### Build-time data fetching

You can remove the loading screen and the time needed to download the JSON file. How? By moving all the work to build time (build time is when you or a build server run `yarn build`).

**Inside any Next.js page, you can export an async [`getStaticProps`](https://nextjs.org/docs/basic-features/data-fetching#getstaticprops-static-generation) function. There, you can put any work that can be done at build time and pass the result as props to the page component.**

Instead of fetching the data when the browser loads the site using the `useData` hook, move the code to `getStaticProps` and pass `data` as a prop to the `HomePage` component.

Note that `getStaticProps` on Node and not on the browser. That's why you can't use the browser's fetch and you need to use some library like `node-fetch`.

<View />

The site isn't showing the loading screen anymore. That's an improvement, but Next.js is still sending all the `data` to the browser, even when only a date is needed.

Instead of passing the whole `data` object to the `HomePage` component, move the code that extracts the date to `getStaticProps` and return `date` as a prop.

Now, when a user visit the site, it will be as fast as the minimal site we had at the beginning.

<View />

Let's do something more interesting and plot part of the data from the JSON file.

Extract the last stats from each country, and pass it to the `HomePage` component as the `rows` prop.

`rows` should look like the following:

```json
[
  { "country": "Albania", "deaths": 20 },
  { "country": "Algeria", "deaths": 96 },
  ...
]
```

<View />

Then use `TreeMap` from [nivo](https://nivo.rocks/) to display the rows.

`TreeMap` divides an area into rectangles, each rectangle size is proportional to the node's value.

By default it looks kind of ugly, but there are a few things that can be done to make it look better.

<View />

Instead of showing the name for each country, you can show the country's flag. Luckily, there's another JSON with exactly that, the emoji flag for each country.

Fetch `countries.json` and add the country's flag to each row.

<View />

Then change a few things in the chart:

- the layout algorithm
- the color scheme
- the labels
- the tooltips

<View />

### Links

It would be nice to be able to click on different countries to go to a page with more details.

For now, wrap each country rectangle inside a link to a country page. A click on Italy will go to `/country/Italy`, a click on Spain to `/country/Spain`, and so on.

You don't need to write a page for each country manually. Next.js a feature called [dynamic routes](https://nextjs.org/docs/routing/dynamic-routes) that solves this for you.

<View />

But before creating the country page, there's another Next.js feature you need to know: the [Link component](https://nextjs.org/docs/api-reference/next/link) from the `next/link` package.

Sin Links, cuando el usuario cliquea en el link, el browser reloads and descarga html, scripts and everything for the new page. Usando Links, Next.js handles the link click, and lazy-loads the next page, downloading only what's needed to render it.

Even better, en nuestro ejemplo, cuando el usuario hovers one of the rectangles, next.js will preload the code and data that the linked page needs, and when the user clicks in the link after reading the tooltip, the page will be ready to be rendered.

<View />

### Dynamic Routes

[dynamic routes](https://nextjs.org/docs/routing/dynamic-routes)

Let's make the add links

So far we haven't done anything impressive. A script that download the JSON and builds the html could do the same without the need of any framework.

Let's show a chart with some stats.

<View />

### getStaticPaths

Let's make the add links

So far we haven't done anything impressive. A script that download the JSON and builds the html could do the same without the need of any framework.

Let's show a chart with some stats.

<View />

Let's make the add links

So far we haven't done anything impressive. A script that download the JSON and builds the html could do the same without the need of any framework.

Let's show a chart with some stats.

<View />

Let's make the add links

So far we haven't done anything impressive. A script that download the JSON and builds the html could do the same without the need of any framework.

Let's show a chart with some stats.

<View />

Let's make the add links

So far we haven't done anything impressive. A script that download the JSON and builds the html could do the same without the need of any framework.

Let's show a chart with some stats.

---

https://nextjs.org/blog/next-9-3
https://nextjs.org/blog/next-9
https://nextjs.org/docs/basic-features/data-fetching
https://nextjs.org/docs/routing/dynamic-routes

</Hike>
